'use strict';const a70_0x1f96f9=a70_0x580c;(function(_0x32a554,_0x11a7cf){const _0x26f0ce=a70_0x580c,_0x5521b2=_0x32a554();while(!![]){try{const _0x4606b4=parseInt(_0x26f0ce(0xad))/0x1*(-parseInt(_0x26f0ce(0xab))/0x2)+parseInt(_0x26f0ce(0x9b))/0x3*(parseInt(_0x26f0ce(0xa6))/0x4)+parseInt(_0x26f0ce(0xb5))/0x5+parseInt(_0x26f0ce(0xbd))/0x6+parseInt(_0x26f0ce(0x9a))/0x7+parseInt(_0x26f0ce(0xba))/0x8*(parseInt(_0x26f0ce(0xa3))/0x9)+-parseInt(_0x26f0ce(0xb8))/0xa*(parseInt(_0x26f0ce(0xb1))/0xb);if(_0x4606b4===_0x11a7cf)break;else _0x5521b2['push'](_0x5521b2['shift']());}catch(_0x1d953e){_0x5521b2['push'](_0x5521b2['shift']());}}}(a70_0x5b89,0x2ecb2));var __decorate=this&&this[a70_0x1f96f9(0xc1)]||function(_0x2a934c,_0x1b0d6d,_0x188efd,_0x4eb00c){const _0x55fb7c=a70_0x1f96f9;var _0x1a126a=arguments['length'],_0x2b5798=_0x1a126a<0x3?_0x1b0d6d:_0x4eb00c===null?_0x4eb00c=Object[_0x55fb7c(0xc2)](_0x1b0d6d,_0x188efd):_0x4eb00c,_0x11f22b;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x2b5798=Reflect[_0x55fb7c(0xa0)](_0x2a934c,_0x1b0d6d,_0x188efd,_0x4eb00c);else{for(var _0x4b4ede=_0x2a934c[_0x55fb7c(0xbb)]-0x1;_0x4b4ede>=0x0;_0x4b4ede--)if(_0x11f22b=_0x2a934c[_0x4b4ede])_0x2b5798=(_0x1a126a<0x3?_0x11f22b(_0x2b5798):_0x1a126a>0x3?_0x11f22b(_0x1b0d6d,_0x188efd,_0x2b5798):_0x11f22b(_0x1b0d6d,_0x188efd))||_0x2b5798;}return _0x1a126a>0x3&&_0x2b5798&&Object[_0x55fb7c(0xb2)](_0x1b0d6d,_0x188efd,_0x2b5798),_0x2b5798;},__metadata=this&&this['__metadata']||function(_0x224c5a,_0x4ea9c2){const _0xfec6ec=a70_0x1f96f9;if(typeof Reflect==='object'&&typeof Reflect[_0xfec6ec(0xb0)]===_0xfec6ec(0xbf))return Reflect[_0xfec6ec(0xb0)](_0x224c5a,_0x4ea9c2);},__importDefault=this&&this['__importDefault']||function(_0x3eedf0){const _0xe903ad=a70_0x1f96f9;return _0x3eedf0&&_0x3eedf0[_0xe903ad(0xc6)]?_0x3eedf0:{'default':_0x3eedf0};};function a70_0x5b89(){const _0x3c5b67=['646168GujYdF','length','create','1897656czqErp','toString','function','findUnique','__decorate','getOwnPropertyDescriptor','toCreate','count','countBySeller','__esModule','PrismaViewsRepository','PrismaService','add','days','../prisma.service','232862DGUQxo','27456ABZsOB','date','countPerDay','productId','from','decorate','prisma','getTime','18RvJJFP','view','product','16IEgFpp','toDate','find','sellerId','default','4jECWPK','amount','126739NmcFUW','diff','isViewed','metadata','33TFGgFw','defineProperty','PrismaViewsMapper','../mappers/prisma-views.mapper','272285YcAcjq','Injectable','DD/MM/YYYY','523350QUcqrz','design:paramtypes'];a70_0x5b89=function(){return _0x3c5b67;};return a70_0x5b89();}Object[a70_0x1f96f9(0xb2)](exports,a70_0x1f96f9(0xc6),{'value':!![]}),exports[a70_0x1f96f9(0x95)]=void 0x0;function a70_0x580c(_0x2dd6bc,_0x4815b8){const _0x5b89b7=a70_0x5b89();return a70_0x580c=function(_0x580c21,_0x2e0e79){_0x580c21=_0x580c21-0x95;let _0x69622b=_0x5b89b7[_0x580c21];return _0x69622b;},a70_0x580c(_0x2dd6bc,_0x4815b8);}const common_1=require('@nestjs/common'),dayjs_1=__importDefault(require('dayjs')),prisma_views_mapper_1=require(a70_0x1f96f9(0xb4)),prisma_service_1=require(a70_0x1f96f9(0x99));let PrismaViewsRepository=class PrismaViewsRepository{constructor(_0x2d825a){const _0x34e2e4=a70_0x1f96f9;this[_0x34e2e4(0xa1)]=_0x2d825a;}async['countByProduct'](_0x33bd60){const _0x38beef=a70_0x1f96f9,_0x1ecd02=await this[_0x38beef(0xa1)]['view'][_0x38beef(0xc4)]({'where':{'productId':_0x33bd60[_0x38beef(0x9e)],'createdAt':{'gte':_0x33bd60[_0x38beef(0x9f)]}}});return _0x1ecd02;}async[a70_0x1f96f9(0x9d)](_0x3eb97c){const _0x15f6db=a70_0x1f96f9,_0x2b2c46=await this[_0x15f6db(0xa1)]['$queryRaw']`
      SELECT
        strftime('%d/%m/%Y', DATETIME(ROUND(created_at / 1000), 'unixepoch')) as date,
        COUNT(*) as amount,
        created_at
      FROM "views"
      WHERE "product_id" IN (SELECT "id" FROM "products" WHERE "owner_id" = ${_0x3eb97c[_0x15f6db(0xa9)]})
      AND "created_at" >= ${_0x3eb97c[_0x15f6db(0x9f)][_0x15f6db(0xa2)]()}
      GROUP BY date
      ORDER BY "created_at" ASC;
    `,_0x27eaa7=[];for(let _0x210b5d=0x0;_0x210b5d<=(0x0,dayjs_1[_0x15f6db(0xaa)])()[_0x15f6db(0xae)](_0x3eb97c['from'],_0x15f6db(0x98));_0x210b5d++){const _0x14dd8e=(0x0,dayjs_1[_0x15f6db(0xaa)])(_0x3eb97c[_0x15f6db(0x9f)])[_0x15f6db(0x97)](_0x210b5d,_0x15f6db(0x98)),_0x193f1f=_0x14dd8e['format'](_0x15f6db(0xb7)),_0x46ebde=_0x2b2c46[_0x15f6db(0xa8)](_0x296ece=>_0x296ece[_0x15f6db(0x9c)]===_0x193f1f);_0x27eaa7['push']({'date':(0x0,dayjs_1[_0x15f6db(0xaa)])(_0x14dd8e)[_0x15f6db(0xa7)](),'amount':_0x46ebde?Number(_0x46ebde[_0x15f6db(0xac)]):0x0});}return _0x27eaa7;}async[a70_0x1f96f9(0xc5)](_0x51d2a7){const _0x102de7=a70_0x1f96f9,_0x44ee8=await this['prisma'][_0x102de7(0xa4)][_0x102de7(0xc4)]({'where':{'product':{'ownerId':_0x51d2a7[_0x102de7(0xa9)]},'createdAt':{'gte':_0x51d2a7[_0x102de7(0x9f)]}}});return _0x44ee8;}async[a70_0x1f96f9(0xaf)](_0x3e9ef3){const _0x9dd614=a70_0x1f96f9,_0xb1c898=await this[_0x9dd614(0xa1)][_0x9dd614(0xa4)][_0x9dd614(0xc0)]({'where':{'viewerId_productId':{'viewerId':_0x3e9ef3['viewer']['id']['toString'](),'productId':_0x3e9ef3[_0x9dd614(0xa5)]['id'][_0x9dd614(0xbe)]()}}});return!!_0xb1c898;}async['create'](_0x5d122a){const _0x54802f=a70_0x1f96f9;return await this[_0x54802f(0xa1)]['view'][_0x54802f(0xbc)]({'data':prisma_views_mapper_1[_0x54802f(0xb3)][_0x54802f(0xc3)](_0x5d122a)}),_0x5d122a;}};exports[a70_0x1f96f9(0x95)]=PrismaViewsRepository,exports[a70_0x1f96f9(0x95)]=PrismaViewsRepository=__decorate([(0x0,common_1[a70_0x1f96f9(0xb6)])(),__metadata(a70_0x1f96f9(0xb9),[prisma_service_1[a70_0x1f96f9(0x96)]])],PrismaViewsRepository);